# Specification: Price Extraction with Retry

## ADDED Requirements

### Requirement: Двойная проверка для извлечения цены
Система SHALL выполнять повторную попытку извлечения цены со страницы товара, если после первого скриншота цена не была обнаружена.

#### Scenario: Цена загружается медленно
- **WHEN** агент открывает страницу товара и делает первый скриншот через 5 секунд
- **AND** цена не обнаружена на первом скриншоте
- **THEN** агент MUST подождать ещё 5 секунд
- **AND** сделать повторный скриншот (fullPage=true)
- **AND** повторно проанализировать скриншот на наличие цены

#### Scenario: Цена загружается быстро
- **WHEN** агент открывает страницу товара и делает первый скриншот через 5 секунд
- **AND** цена успешно обнаружена на первом скриншоте
- **THEN** агент SHALL NOT делать повторный скриншот
- **AND** продолжить с извлечённой ценой

#### Scenario: Цена не загружается после двух попыток
- **WHEN** агент сделал две попытки извлечения цены (2 скриншота с интервалом 5 секунд)
- **AND** цена не обнаружена ни на одном из скриншотов
- **THEN** агент MUST считать что пользователь не авторизован
- **AND** сохранить товар с пустым полем E (цена)
- **AND** SHALL NOT помечать товар как "не найдено"

## MODIFIED Requirements

### Requirement: Стратегия скриншотов страницы товара
Система SHALL использовать последовательность: navigate → wait(5s) → screenshot → [анализ] → [retry если нужно].

#### Scenario: Полный workflow извлечения деталей товара
- **WHEN** агент переходит на страницу товара для извлечения деталей
- **THEN** агент ДОЛЖЕН выполнить следующую последовательность:
  1. `navigate(product_url)`
  2. `wait_for(time=5)` - первичное ожидание
  3. `take_screenshot(fullPage=true)` - первый скриншот
  4. Анализ скриншота: поиск цены и названия
  5. ЕСЛИ цена не найдена:
     - `wait_for(time=5)` - дополнительное ожидание
     - `take_screenshot(fullPage=true)` - повторный скриншот
     - Повторный анализ на наличие цены
  6. Формирование результата с ценой (или без, если не найдена после 2 попыток)
